<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `diesel_migrations` crate."><meta name="keywords" content="rust, rustlang, rust-lang, diesel_migrations"><title>diesel_migrations - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../dark.css"><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script src="../storage.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="../favicon.ico"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../diesel_migrations/index.html'><div class='logo-container'><img src='../rust-logo.png' alt='logo'></div></a><p class='location'>Crate diesel_migrations</p><div class="sidebar-elems"><a id='all-types' href='all.html'><p>See all diesel_migrations's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'diesel_migrations', ty: 'mod', relpath: '../'};</script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../src/diesel_migrations/lib.rs.html#2-193' title='goto source code'>[src]</a></span><span class='in-band'>Crate <a class="mod" href=''>diesel_migrations</a></span></h1><div class='docblock'><p>Provides functions for maintaining database schema.</p>
<p>A database migration always provides procedures to update the schema, as well as to revert
itself. Diesel's migrations are versioned, and run in order. Diesel also takes care of tracking
which migrations have already been run automatically. Your migrations don't need to be
idempotent, as Diesel will ensure no migration is run twice unless it has been reverted.</p>
<p>Migrations should be placed in a <code>/migrations</code> directory at the root of your project (the same
directory as <code>Cargo.toml</code>). When any of these functions are run, Diesel will search for the
migrations directory in the current directory and its parents, stopping when it finds the
directory containing <code>Cargo.toml</code>.</p>
<p>Individual migrations should be a folder containing exactly two files, <code>up.sql</code> and <code>down.sql</code>.
<code>up.sql</code> will be used to run the migration, while <code>down.sql</code> will be used for reverting it. The
folder itself should have the structure <code>{version}_{migration_name}</code>. It is recommended that
you use the timestamp of creation for the version.</p>
<p>Migrations can either be run with the CLI or embedded into the compiled application
and executed with code, for example right after establishing a database connection.
For more information, consult the <a href="macro.embed_migrations.html"><code>embed_migrations!</code></a> macro.</p>
<h2 id="example" class="section-header"><a href="#example">Example</a></h2>
<pre><code class="language-text"># Directory Structure
- 20151219180527_create_users
    - up.sql
    - down.sql
- 20160107082941_create_posts
    - up.sql
    - down.sql
</code></pre>
<pre><code class="language-sql">-- 20151219180527_create_users/up.sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name VARCHAR NOT NULL,
  hair_color VARCHAR
);
</code></pre>
<pre><code class="language-sql">-- 20151219180527_create_users/down.sql
DROP TABLE users;
</code></pre>
<pre><code class="language-sql">-- 20160107082941_create_posts/up.sql
CREATE TABLE posts (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL,
  title VARCHAR NOT NULL,
  body TEXT
);
</code></pre>
<pre><code class="language-sql">-- 20160107082941_create_posts/down.sql
DROP TABLE posts;
</code></pre>
</div><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table><tr class='module-item'><td><a class="mod" href="connection/index.html" title='diesel_migrations::connection mod'>connection</a></td><td class='docblock-short'></td></tr></table><h2 id='macros' class='section-header'><a href="#macros">Macros</a></h2>
<table><tr class='module-item'><td><a class="macro" href="macro.embed_migrations.html" title='diesel_migrations::embed_migrations macro'>embed_migrations</a></td><td class='docblock-short'><p>This macro will read your migrations at compile time, and embed a module you can use to execute
them at runtime without the migration files being present on the file system. This is useful if
you would like to use Diesel's migration infrastructure, but want to ship a single executable
file (such as for embedded applications). It can also be used to apply migrations to an in
memory database (Diesel does this for its own test suite).</p>
</td></tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.MigrationName.html" title='diesel_migrations::MigrationName struct'>MigrationName</a></td><td class='docblock-short'></td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.MigrationError.html" title='diesel_migrations::MigrationError enum'>MigrationError</a></td><td class='docblock-short'><p>Errors that occur while preparing to run migrations</p>
</td></tr><tr class='module-item'><td><a class="enum" href="enum.RunMigrationsError.html" title='diesel_migrations::RunMigrationsError enum'>RunMigrationsError</a></td><td class='docblock-short'><p>Errors that occur while running migrations</p>
</td></tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table><tr class='module-item'><td><a class="trait" href="trait.Migration.html" title='diesel_migrations::Migration trait'>Migration</a></td><td class='docblock-short'><p>Represents a migration that interacts with diesel</p>
</td></tr><tr class='module-item'><td><a class="trait" href="trait.MigrationConnection.html" title='diesel_migrations::MigrationConnection trait'>MigrationConnection</a></td><td class='docblock-short'><p>A connection which can be passed to the migration methods. This exists only
to wrap up some constraints which are meant to hold for <em>all</em> connections.
This trait will go away at some point in the future. Any Diesel connection
should be useable where this trait is required.</p>
</td></tr></table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table><tr class='module-item'><td><a class="fn" href="fn.any_pending_migrations.html" title='diesel_migrations::any_pending_migrations fn'>any_pending_migrations</a></td><td class='docblock-short'><p>See the <a href="index.html">module level documentation</a> for information on how migrations should be
structured, and where Diesel will look for them by default.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.find_migrations_directory.html" title='diesel_migrations::find_migrations_directory fn'>find_migrations_directory</a></td><td class='docblock-short'><p>Returns the directory containing migrations. Will look at for
$PWD/migrations. If it is not found, it will search the parents of the
current directory, until it reaches the root directory.  Returns
<code>MigrationError::MigrationDirectoryNotFound</code> if no directory is found.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.mark_migrations_in_directory.html" title='diesel_migrations::mark_migrations_in_directory fn'>mark_migrations_in_directory</a></td><td class='docblock-short'><p>Compares migrations found in <code>migrations_dir</code> to those that have been applied.
Returns a list of pathbufs and whether they have been applied.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.migration_from.html" title='diesel_migrations::migration_from fn'>migration_from</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="fn" href="fn.name.html" title='diesel_migrations::name fn'>name</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="fn" href="fn.revert_latest_migration.html" title='diesel_migrations::revert_latest_migration fn'>revert_latest_migration</a></td><td class='docblock-short'><p>Reverts the last migration that was run. Returns the version that was reverted. Returns an
<code>Err</code> if no migrations have ever been run.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.revert_latest_migration_in_directory.html" title='diesel_migrations::revert_latest_migration_in_directory fn'>revert_latest_migration_in_directory</a></td><td class='docblock-short'></td></tr><tr class='module-item'><td><a class="fn" href="fn.run_migrations.html" title='diesel_migrations::run_migrations fn'>run_migrations</a></td><td class='docblock-short'><p>Run all pending migrations in the given list. Apps should likely be calling
<code>run_pending_migrations</code> or <code>run_pending_migrations_in_directory</code> instead.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.run_pending_migrations.html" title='diesel_migrations::run_pending_migrations fn'>run_pending_migrations</a></td><td class='docblock-short'><p>Runs all migrations that have not yet been run. This function will print all progress to
stdout. This function will return an <code>Err</code> if some error occurs reading the migrations, or if
any migration fails to run. Each migration is run in its own transaction, so some migrations
may be committed, even if a later migration fails to run.</p>
</td></tr><tr class='module-item'><td><a class="fn" href="fn.search_for_migrations_directory.html" title='diesel_migrations::search_for_migrations_directory fn'>search_for_migrations_directory</a></td><td class='docblock-short'><p>Searches for the migrations directory relative to the given path. See
<code>find_migrations_directory</code> for more details.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g., <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g., <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g., <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../";window.currentCrate = "diesel_migrations";</script><script src="../aliases.js"></script><script src="../main.js"></script><script defer src="../search-index.js"></script></body></html>